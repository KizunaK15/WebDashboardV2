<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Terapi Saya - PRIME Care</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        .sidebar-link { transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out; }
        .schedule-card { transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; }
        .schedule-card:hover { transform: translateY(-4px); box-shadow: 0 8px 16px rgba(0,0,0,0.05); }
    </style>
</head>
<body>
    <div class="flex h-screen">
        <!-- Sidebar -->
        <aside class="w-64 flex-shrink-0 bg-white border-r border-gray-200 flex flex-col">
            <div class="h-16 flex items-center justify-center border-b border-gray-200">
                <h1 class="text-2xl font-bold text-blue-600">PRIME Care</h1>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-2">
                <a href="dashboardpasien.html" class="sidebar-link flex items-center px-4 py-2.5 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg">Dashboard Saya</a>
                <a href="jadwalpasien.html" class="sidebar-link flex items-center px-4 py-2.5 text-sm font-medium text-white bg-blue-600 rounded-lg">Jadwal Terapi</a>
            </nav>
            <div class="mt-auto p-4 border-t border-gray-200 space-y-2">
                <a href="gantipassword.html" class="sidebar-link flex items-center px-4 py-2.5 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg">Ganti Password</a>
                <a href="iot_login_page.html" class="sidebar-link flex items-center px-4 py-2.5 text-sm font-medium text-gray-600 hover:bg-gray-100 rounded-lg">Logout</a>
            </div>
        </aside>

        <!-- Konten Utama -->
        <main class="flex-1 overflow-y-auto p-8">
            <header class="mb-8">
                <h2 class="text-3xl font-bold text-gray-800">Jadwal Terapi Saya</h2>
                <p class="text-gray-500 mt-1">Lihat semua jadwal terapi Anda yang akan datang dan yang sudah lewat.</p>
            </header>

            <!-- Jadwal Mendatang -->
            <div class="mb-10">
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Jadwal Mendatang</h3>
                <div id="upcoming-schedules" class="space-y-4">
                    <!-- Jadwal mendatang akan diisi oleh JavaScript -->
                </div>
            </div>

            <!-- Riwayat Jadwal -->
            <div>
                <h3 class="text-xl font-semibold text-gray-700 mb-4">Riwayat Jadwal</h3>
                <div id="past-schedules" class="space-y-4">
                    <!-- Riwayat jadwal akan diisi oleh JavaScript -->
                </div>
            </div>
        </main>
    </div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const patientId = localStorage.getItem('patientId');
        if (!patientId) {
            alert("Sesi tidak valid. Silakan login kembali.");
            window.location.href = 'iot_login_page.html';
            return;
        }
        loadSchedules(patientId);
    });

    async function loadSchedules(patientId) {
        const upcomingContainer = document.getElementById('upcoming-schedules');
        const pastContainer = document.getElementById('past-schedules');
        upcomingContainer.innerHTML = '<p class="text-gray-500">Memuat jadwal...</p>';
        pastContainer.innerHTML = '<p class="text-gray-500">Memuat riwayat...</p>';

        try {
            const response = await fetch(`http://localhost:3000/api/schedules/${patientId}`);
            if (!response.ok) throw new Error('Gagal memuat jadwal.');
            
            const schedules = await response.json();
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const upcoming = schedules.filter(s => new Date(s.date) >= today).sort((a,b) => new Date(a.date) - new Date(b.date));
            const past = schedules.filter(s => new Date(s.date) < today).sort((a,b) => new Date(b.date) - new Date(a.date));

            renderSchedules(upcomingContainer, upcoming, 'Belum ada jadwal mendatang.');
            renderSchedules(pastContainer, past, 'Tidak ada riwayat jadwal.', true);

        } catch (error) {
            console.error('Gagal memuat jadwal:', error);
            upcomingContainer.innerHTML = `<p class="text-red-500">${error.message}</p>`;
            pastContainer.innerHTML = `<p class="text-red-500">${error.message}</p>`;
        }
    }

    function renderSchedules(container, scheduleArray, emptyMessage, isPast = false) {
        container.innerHTML = '';
        if (scheduleArray.length === 0) {
            container.innerHTML = `<p class="text-gray-500">${emptyMessage}</p>`;
            return;
        }

        scheduleArray.forEach(s => {
            const card = document.createElement('div');
            const cardColor = isPast ? 'bg-white' : 'bg-blue-50';
            card.className = `schedule-card p-5 rounded-lg flex items-center space-x-5 ${cardColor} shadow-sm`;
            
            const date = new Date(s.date);
            const day = date.getDate();
            const month = date.toLocaleString('id-ID', { month: 'short' }).toUpperCase();

            card.innerHTML = `
                <div class="flex-shrink-0 text-center w-16 p-2 rounded-md ${isPast ? 'bg-gray-100' : 'bg-blue-100'}">
                    <p class="text-2xl font-bold ${isPast ? 'text-gray-600' : 'text-blue-800'}">${day}</p>
                    <p class="text-xs font-semibold ${isPast ? 'text-gray-500' : 'text-blue-600'}">${month}</p>
                </div>
                <div>
                    <p class="font-semibold text-gray-800">${s.description}</p>
                    <p class="text-sm text-gray-600">Pukul ${s.time}</p>
                </div>
            `;
            container.appendChild(card);
        });
    }
</script>
</body>
</html>
